// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2019 NXP
 * Copyright 2024 Koan Software
 */

/dts-v1/;

#include "imx8mp-astrial-base.dtsi"

/delete-node/ &imx219_0;
/delete-node/ &imx219_1;

&iomuxc {
	pinctrl-0 = <
		&pinctrl_hog
		&pinctrl_gpio_flexcan2
		&pinctrl_gpio_spi2
		&pinctrl_gpio_uart3
		&pinctrl_gpio_sdhc1
	>;
};

&i2c6 {
    arducam_pivariety_0: arducam_pivariety_mipi@c {
        compatible = "arducam,arducam-pivariety";
        reg = <0x0c>;
        pinctrl-0 = <&pinctrl_csi0_rst>, <&pinctrl_csi_mclk>;
        clocks = <&clk IMX8MP_CLK_IPP_DO_CLKO2>;
        clock-names = "xclk";
        assigned-clocks = <&clk IMX8MP_CLK_IPP_DO_CLKO2>;
        assigned-clock-parents = <&clk IMX8MP_CLK_24M>;
        assigned-clock-rates = <24000000>;
        csi_id = <0>;
        powerdown-gpios = <&gpio2 11 GPIO_ACTIVE_HIGH>;
        reset-gpios = <&gpio1 6 GPIO_ACTIVE_LOW>;
        mclk = <24000000>;
        mclk_source = <0>;
        mipi_csi;
        status = "okay";

        port {
            arducam_pivariety_mipi_0_ep: endpoint {
                remote-endpoint = <&mipi_csi0_ep>;
                data-lanes = <1 2>;
                clock-lanes = <0>;
			};
		};
	};

};

&i2c2 {
	arducam_pivariety_1: arducam_pivariety_mipi@c {
		compatible = "arducam,arducam-pivariety";
		reg = <0x0c>;
		pinctrl-0 = <&pinctrl_csi0_rst>, <&pinctrl_csi_mclk>;
		clocks = <&clk IMX8MP_CLK_IPP_DO_CLKO2>;
		clock-names = "xclk";
		assigned-clocks = <&clk IMX8MP_CLK_IPP_DO_CLKO2>;
		assigned-clock-parents = <&clk IMX8MP_CLK_24M>;
		assigned-clock-rates = <24000000>;
		csi_id = <1>;
		// powerdown-gpios = <&gpio4 1 GPIO_ACTIVE_HIGH>;
		// reset-gpios = <&gpio4 0 GPIO_ACTIVE_LOW>;
		mclk = <24000000>;
		mclk_source = <0>;
		mipi_csi;
		status = "okay";

		port {
			arducam_pivariety_mipi_1_ep: endpoint {
				remote-endpoint = <&mipi_csi1_ep>;
				data-lanes = <1 2>;
				clock-lanes = <0>;
            };
        };
    };
};

&mipi_csi_0 {
    port@0 {
        reg = <0>;
        mipi_csi0_ep: endpoint {
            remote-endpoint = <&arducam_pivariety_mipi_0_ep>;
            data-lanes = <2>;
            csis-hs-settle = <30>;
            csis-clk-settle = <2>;
            csis-wclk;
        };
    };
};

&mipi_csi_1 {
    port@1 {
        reg = <1>;
        mipi_csi1_ep: endpoint {
            remote-endpoint = <&arducam_pivariety_mipi_1_ep>;
            data-lanes = <2>;
            csis-hs-settle = <30>;
            csis-clk-settle = <2>;
            csis-wclk;
        };
    };
};

&isp_0 {
    status = "disabled";
};

&isp_1 {
    status = "disabled";
};

&dewarp {
    status = "disabled";
};



&isi_0 {
    status = "okay";

    cap_device {
        status = "okay";
    };

    m2m_device {
        status = "okay";
    };
};

&isi_1 {
    status = "okay";

    cap_device {
        status = "okay";
    };

    m2m_device {
        status = "okay";
    };
};